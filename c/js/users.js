function hybridLogin(e){return showLoader(),$.ajax({type:"GET",url:"/auth/service.php",data:{provider:e},success:function(e){0==e.error?1==e.success?window.location.href=e.success_url:(hideLoader(),window.location.href="/"):(hideLoader(),showNotification(e.message))},dataType:"json"}),!1}function login_process(){var e=$("#form_login").parsley().validate();if(e){var a=$("#answer_field").val(),r=parseInt(1*$("#no_1").val()),o=parseInt(1*$("#no_2").val()),s=parseInt(1*$("#no_3").val());if(""!=a&&a!=r+o+s)return $("#login_error").html("Wrong answer."),$("#div_login_error").show(),void $("#answer_field").addClass("parsley-error").focus();showLoader();var i=$("#form_login").serialize();$.ajax({type:"POST",url:"/user/login",data:i,dataType:"json",success:function(e){if(1!=e.error)window.location.href="/securingPage";else if(hideLoader(),"wrong_login"==e.error_code){var a=$("#wrong_pass_check").val();1==a?showQuestion():(a=++a,$("#wrong_pass_check").val(a)),$("#login_error").html(e.error_msg),$("#div_login_error").show(),$("#email").addClass("parsley-error").focus(),$("#passwd").addClass("parsley-error")}else if("multiple_user"==e.error_code){var r='<select name="user_name" id="user_name" required="" class="form-control"><option value="">-- Select Username --</option>';$(e.user_name).each(function(e,a){r+='<option value="'+a+'">'+a+"</option>"}),$("#div_select_user_name").html(r),$("#div_user_name").show(),$("#login_error").html(e.error_msg),$("#div_login_error").show(),$("#user_name").addClass("parsley-error")}else"qr_enabled"==e.error_code?($("#qr_modal").find("#user").val(e.user),$("#qr_modal").find("#qr_emailid").html(e.user_email),$("#qr_modal").find("#qr_code").focus(),$("#qr_modal").find("#span_mobile").html(e.user_mobile_sub),$("#qr_modal").find("#mobile_number").val(e.user_mobile),$("#qr_modal").find("#div_otp_input").hide(),$("#qr_modal").find("#btn_submit_otp").hide(),$("#qr_modal").find("#btn_send_otp").show(),$("#qr_modal").find("#div_mfa_reset").hide(),$("#qr_modal").find("#div_mfa").show(),$("#qr_modal").modal("show")):"verify_pending"==e.error_code&&($("#verify_div").find("#user").val(e.user),$("#verify_div").find("#verify_emailid").val(e.user_email),$("#verify_div").find("#verify_code").focus(),showVerifyDiv())}})}return!1}function showQuestion(){var e=Math.floor(10*Math.random()+1),a=Math.floor(10*Math.random()+1),r=Math.floor(10*Math.random()+1);$("#number_first").html(e),$("#number_second").html(a),$("#number_third").html(r),$("#no_1").val(e),$("#no_2").val(a),$("#no_3").val(r),$("#answer_field").focus(),$("#answer_field").val(""),$("#verify_user").show()}function admin_login_process(){$("#admin_login_form").validationEngine("attach");var e=$("#admin_login_form").validationEngine("validate");if(e){var a=$("#admin_login_form").serialize();$.ajax({type:"POST",url:"login.php",data:a,dataType:"json",success:function(e){1!=e.error?window.location.href="dashboard.php":"qr_enabled"==e.error_code?(jQuery.facebox({div:"#mfa_modal"}),$("#facebox").find("#user").val(e.user),$("#facebox").find("#qr_code").focus()):($("#login_message").html("wrong user name or passoword"),$("#login_message").show())}})}return!1}function homeNotificationHide(){$("#siginNotification").fadeOut()}function registeration_process(){$("#capcha").closest(".form-group").removeClass("has-error"),$("#capcha").closest(".form-group").find(".help-block").html("");var e=$("#form_registration").parsley().validate();if(e){$("#defaultModal").modal("show"),showLoader();var a=$("#form_registration").serialize();$.ajax({type:"POST",url:"/user/register",data:a,dataType:"json",success:function(e){hideLoader(),1==e.captcha_error?($("#captcha_img").attr("src","/capcha/image.php?rand="+1e3*Math.random()),$("#capcha").val(""),$("#capcha").focus(),$("#capcha").closest(".form-group").addClass("has-error"),$("#capcha").closest(".form-group").find(".help-block").html("Invalid captcha code.")):"verify_pending"==e.error_code?($("#verify_div").find("#user").val(e.user),$("#verify_div").find("#user_pwd").val(e.user_pwd),$("#verify_div").find("#verify_emailid").val(e.user_email),$("#verify_div").find("#verify_code").focus(),showVerifyDiv()):0==e.error?window.location.href="/securingPage":($("#g_captcha_error").hide(),"user_name"==e.error_code?$("#uname").addClass("parsley-error").focus():"user_email"==e.error_code&&$("#user_email").addClass("parsley-error").focus(),$("#registration_error").html(e.error_msg),$("#div_registration_error").show())}})}return!1}function clearForm(e){$(e).find(":input").each(function(){switch(this.type){case"password":case"select-multiple":case"select-one":case"text":case"textarea":case"email":case"hidden":$(this).val("");break;case"checkbox":case"radio":this.checked=!1}})}function update_process(){$("#form_user").validationEngine("attach");var e=$("#form_user").validationEngine("validate");if(e){showLoader();var a=$("#form_user").serialize();$.ajax({type:"POST",url:"user.php?action=update",data:a,success:function(e){hideLoader(),1==e.validate_error?showNotification(e.validate_message[0]):showNotification(e.validate_message[0])},dataType:"json"})}return!1}function changePassword(e){$(e).validationEngine("attach");var a=$(e).validationEngine("validate");if(a){showLoader();var r=$(e).serialize();$.ajax({type:"POST",url:"user/update_password",data:r,success:function(e){hideLoader(),1==e.validate_error?showNotification(e.validate_message[0]):showNotification(e.validate_message[0])},dataType:"json"})}return!1}function forgotPasswordProcess(){var e=$("#forgotpass_form").parsley().validate();if(e){showLoader();var a=$("#forgotpass_form").serialize();$.ajax({type:"POST",url:"/forgotpass/select",data:a,dataType:"json",success:function(e){hideLoader();var a="",r=e.length;if(r>0&&"undefined"!=typeof e[0].user_uname)for(var o=0;r>o;o++){var s=e[o].user_uname,i=s.split(":"),t="",d="class=hidden";("Google"==i[0]||"Twitter"==i[0]||"Yahoo"==i[0]||"Facebook"==i[0]||"M"==i[0])&&(t="style=display:none;",d=""),a+='<div class="p-10 media row-hover-bg">',a+='<div class="pull-right p-relative"><button class="btn btn-md btn-link c-blue b-1 text-transform-none"'+t+"onclick=\"sendForgotPasswordMail('"+e[o].hidden_user_uid+"');\">Send Email</button></div>",a+='<div class="media-body">',a+='<div class="lv-title f-16">'+e[o].user_uname+"</div>",a+='<small class="lv-small f-14">',"undefined"!=typeof e[o].pan&&(a+=e[o].pan+" | "),a+=e[o].user_email+"</small>",a+='<small class="lv-small f-14"><div '+d+' id="user_help_tip_'+i[0]+'" class="single_user"></div></small>',a+="</div>",a+="</div>"}else a+='<div class=" p-10 media row-hover-bg c-red">No Records Found. Please check the value you have entered</div>',$("#listing_header").html("");$("#listing_tbody").html(a),$("#listing_table").show(),goToByScroll("#listing_table"),$("#div_forgot_sucess").hide(),$("#success_msg").html("")}})}return!1}function sendForgotPasswordMail(e){var a="select_email="+e;return showLoader(),$.ajax({type:"POST",url:"/forgotpass/forgotpass",data:a,dataType:"json",success:function(e){hideLoader(),0==e.error?(swal("Mail Sent!",e.msg,"success"),$("#listing_table").hide(),$("#div_mail_not_received").show()):($("#forgot_error").html(e.msg),$("#div_forgot_error").removeClass("hidden").show())}}),!1}function updatePassword(e){var a=$(e).validationEngine("validate");return a&&$(e).submit(),!1}function forgotPasswordNoEmail(e){var a=$(e).parsley().validate();if(a){showLoader();var r=$(e).serialize();$.ajax({type:"POST",url:"forgotpassnoemail/reset_pass",data:r,dataType:"json",success:function(e){hideLoader(),0!=e.error?showNotification("danger",e.msg):window.location="/start-tax-return"}})}return!1}function removeErrors(){return $("#form_registration input").each(function(){$(this).removeClass("fieldError")}),!1}function changeSettings(e){clearForm("#change_user_name_form"),clearForm("#change_password_form"),clearForm("#change_email_form"),$(".div_forms").hide(),$("#div_error").hide(),$("#settings_form").show(),1==e?($("#div_change_user").show(),goToByScroll("#div_change_user")):2==e?($("#div_change_password").show(),goToByScroll("#div_change_password")):3==e?($("#div_change_email").show(),goToByScroll("#div_change_email")):4==e&&($("#div_change_mobile").show(),goToByScroll("#div_change_mobile"))}function submitSettingsForm(e,a){var r=$(e).parsley().validate();if(r){showLoader();var o=$(e).serialize();$.ajax({type:"POST",url:"/settings/"+a,data:o,dataType:"json",success:function(e){hideLoader(),1==e.error?($("#span_error").html(e.error_msg),$("#div_error").show()):(showNotification(toastrSaved,e.error_msg,toastrSavedClass),$(".div_forms").hide(),$("#div_error").hide(),"change_user"==a?$("#td_username").html(e.userName):"change_email"==a?$("#td_useremail").html(e.userEmail):"change_mobile"==a&&$("#td_mobile").html(e.mobile),goToByScroll(".tab-content"))}})}return!1}function validatePass(e){"User"==e?($("#user_input").attr("data-parsley-type","username"),$("#user_input").attr("placeholder","Enter your username")):"EmailId"==e?($("#user_input").attr("data-parsley-type","email"),$("#user_input").attr("placeholder","Enter your emailid")):"PAN"==e?($("#user_input").attr("data-parsley-type","pan_all"),$("#user_input").attr("placeholder","Enter your PAN no")):$("#user_input").attr("placeholder","")}function changeSmsNewsletters(e,a){var r=0;1==$("#sms_newsletters").prop("checked")&&(r=1),showLoader(),$.ajax({type:"POST",url:"/settings/update_sms",data:{id:e,user_email:a,value:r},dataType:"json",success:function(e){hideLoader(),showNotification(toastrSaved,dataUpdateMsg,toastrSavedClass)}})}function login_merge(){var e=$("#merge_assessee_form").parsley().validate();if(e){showLoader();var a=$("#merge_assessee_form").serialize();$.ajax({type:"POST",url:"settings/login",data:a,dataType:"json",success:function(e){if(hideLoader(),$("#span_merge_error").html(""),$("#div_merge_error").hide(),$("#pass").val(""),1==e.error)1==e.sameuser?bootstrapWarning(e.error_msg_m):(bootstrapWarning(e.error_msg),$("#uname").val(""),$("#uname").focus());else{var a="",r=e.merge_data.length;if(r>0)for(var o=0;r>o;o++){var s=e.merge_data[o].PANno,i=e.merge_data[o].display_name,t=e.merge_data[o].ass_id,d="Already exist";0==e.merge_data[o].exist&&(d='<a href="javascript:void(0)" onclick="edit_merge_process(\''+e.merge_data[o].ass_id+"');\">Merge</a>"),a+='<input type="hidden" id="emailid" value="'+e.userEmail+'"/>',a+='<tr id="tr_'+t+'">',a+='<input type="hidden" id="pan_'+t+'" value="'+s+'"/>',a+='<input type="hidden" id="username_'+t+'" value="'+i+'"/>',a+='<td class="hidden-xs hidden-sm">'+s+"</td>",a+='<td class="">'+i+"</td>",a+='<td class="">'+d+"</td>",a+="</tr>"}else a+="<tr>",a+='<td width="100" colspan="4" align="center">No Records Found</td>',a+="</tr>";$("#listing_tbody").html(a),$("#listing_table").show(),goToByScroll("#listing_table")}}})}return!1}function edit_merge_process(e){$("#modal_merge_ass").find("#span_modal_error").html(""),$("#modal_merge_ass").find("#div_modal_error").hide(),clearForm("#modal_merge_ass #form_merge");var a=$("#pan_"+e).val(),r=$("#username_"+e).val(),o=$("#merge_assessee_form").find("#uname").val(),s=$("#emailid").val();$("#modal_merge_ass").find("#ass_id").val(e),$("#modal_merge_ass").find("#pan").val(a),$("#modal_merge_ass").find("#username").val(o),$("#modal_merge_ass").find("#email").val(s),$("#modal_merge_ass").find("#span_ass_name").html(r),$("#modal_merge_ass").find("#span_username").html(o),$("#modal_merge_ass").modal("show")}function confirmSaveCapcha(){var e=$("#form_merge").parsley().validate();if(e){var a=$("#form_merge").serialize();$.ajax({type:"POST",url:"settings/save_merge",data:a,global:!1,dataType:"json",success:function(e){if(1==e.error)$("#modal_merge_ass").find("#captchaimg").attr("src","/capcha/image.php?rand="+1e3*Math.random()),$("#modal_merge_ass").find("#span_modal_error").html(e.error_msg),$("#modal_merge_ass").find("#div_modal_error").show();else{var a=$("#modal_merge_ass").find("#ass_id").val();$("#modal_merge_ass").modal("hide"),$("#tr_"+a).remove(),showNotification(toastrSaved,"Data merge successfully",toastrSavedClass)}}})}return!1}function showUserEmail(e){""!=e?$("#div_demerge").show():$("#div_demerge").hide()}function check_user_email(){var e=$("#demerge_assessee_form").parsley().validate();if(e){showLoader();var a=$("#demerge_assessee_form").serialize();$.ajax({type:"POST",url:"settings/check_user_email",data:a,dataType:"json",success:function(e){e==LOGOUT&&redirectToLogout(),hideLoader(),1==e.error?(bootstrapWarning(e.msg),$("#ue_username").val(""),$("#ue_username").focus(),$("#ue_emailid").val("")):(e.pan&&$("#pan_demerge option[value='"+e.pan_data+"']").attr("disabled","disabled"),$("#div_demerge").hide(),$("#demerge_listing_tbody").append('<tr id="tr_demerge_'+e.assId+'"><td class="p-l-10">'+e.pan+"</td><td>"+e.display_name+"</td><td>"+e.user_uname+"</td><td>"+e.user_email+'</td><td><a title="Enter Code" href="javascript:void(0);" onClick="demerge_process(\''+e.display_name+"','"+e.user_uuid+'\')">Enter Code</a> | <a href="javascript:void(0);" title="Cancel Demerge" onClick="cancel_demerge(\''+e.display_name+"','"+e.id+"','"+e.user_uuid+'\')">Cancel Demerge</a> | <span id="resend_'+e.id+'"><a href="javascript:void(0);" title="Cancel Demerge" onClick="resend_code_ask(\''+e.assId+"','"+e.id+"')\">Resend Code</a></span></td></tr>"),$("#div_demerge_error").hide(),swal(e.msg,"","success"),$("#demerge_listing_table").show(),$("#pan_demerge").val(""),$("#ue_username").val(""),$("#ue_emailid").val(""))}})}return!1}function showHelpTip(){var e="";$(".single_user").each(function(){var a=$(this).attr("id"),r=a.split("_");e="Please note that you can not change the password of "+r[3]+" account through forgot password link of myITreturn. You can change the password through the options available on "+r[3]+".";var o=a;if(e.length>0){var s="help_"+o,i='<span id="span_'+o+'" onMouseOver="showHelpIcon(\''+s+"')\" onMouseOut=\"hideHelpIcon('"+s+'\')" ><img src="images/old/pricing/icon_info.png" style="margin:4px 0 0 5px; vertical-align:text-top;"></span>';i+='<div id="wizardPopup" class=" '+s+'" style="margin-left: 25px;display:none;"><div id="popupWizard"><img src="/images/old/wizard/wizardpopupArrow.png" width="16" height="32" /></div><div id="wizardpopContent" style="line-height : 18px;text-align: justify;"><span class="bulletBlackColor fontVerdana fontSize12">',i+=e,i+="</span></div></div>",$("td #"+o).append(i)}})}function forgotPassChangeSubmit(e){var a=$(e).parsley().validate();if(a){showLoader();var r=$(e).serialize();$.ajax({type:"POST",url:"/forgotpasschange/reset_post",data:r,dataType:"json",success:function(e){hideLoader(),0!=e.error?showNotification("danger",e.msg):window.location="/start-tax-return"}})}return!1}function cancel_demerge(e,a,r){var o=confirm("Do you wish to cancel this de-merging?");if(o){showLoader();var s="cancel_demerge_id="+a+"&cancel_demerge_touserid="+r;$.ajax({type:"POST",url:"settings/cancel_demerge",data:s,global:!1,dataType:"json",success:function(e){e==LOGOUT&&redirectToLogout(),hideLoader(),0==e.count&&($("#demerge_listing_table").hide(),$("#success_message_demerge").hide()),$("#tr_demerge_"+e.ass_id).remove(),$("#pan_demerge option[value='"+e.pan+"']").removeAttr("disabled")}})}}function resend_code_ask(e,a){var r=confirm("Do you wish to resend the code ?");if(r){showLoader();var o="demerge_id="+a+"&ass_id="+e;$("#resend_"+a).html("Resend Code"),$.ajax({type:"POST",url:"settings/resend_code_demerge",data:o,global:!1,dataType:"json",success:function(e){e==LOGOUT&&redirectToLogout(),hideLoader(),showNotification(toastrSaved,"Code has been successfully sent on user's email id. ",toastrSavedClass),$("#resend_"+a).html("Resend Code")}})}}function demerge_process(e,a){$("#modal_demerge_process").find("#demergedata_id").val(a),$("#modal_demerge_process").find("#span_demerge_name").html(e),$("#modal_demerge_process").modal("show")}function confirmDemergeCode(){var e=$("#form_demerge_data").parsley().validate();if(e){var a=$("#form_demerge_data").serialize();$.ajax({type:"POST",url:"settings/demerge_data",data:a,global:!1,dataType:"json",success:function(e){1==e.error?($("#modal_demerge_process").find("#span_demerge_process_error").html(e.error_msg),$("#modal_demerge_process").find("#div_demerge_process_error").show()):($("#modal_demerge_process").modal("hide"),window.location="/settings")}})}return!1}function goToSignUp(){$(".tab_login").removeClass("active"),$(".li_login").removeClass("active"),$("#new_user").addClass("active"),$("#li_new_user").addClass("active"),clearForm("#form_registration"),$("#uname").focus()}function verifyMfaCode(){var e=$("#form_qr").parsley().validate();if(e){showLoader();var a=$("#form_qr").serialize();$.ajax({type:"POST",url:"/settings/verify_qr_code",data:a,dataType:"json",success:function(e){e==LOGOUT&&redirectToLogout(),hideLoader(),e>0?(swal("Congratulations","Your Security+ has been activated. Next time you login, you will be asked to enter the Authentication code from the Google Authenticator App","success"),$("#div_disable").show(),$("#div_enable").hide()):($("#qr_code").val(""),$("#qr_code").addClass("parsley-error").focus(),swal("Invalid Authentication Code.","Check that you have entered the correct code from the Google Authenticator App.","info"))}})}}function disableMfaCode(){swal({title:"Attention",text:"Do you want to disable myITreturn Security+?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes",cancelButtonText:"No",closeOnConfirm:!0,closeOnCancel:!0},function(e){e&&(showLoader(),$.ajax({type:"POST",url:"/settings/disable_qr_code",data:"",dataType:"json",success:function(e){e==LOGOUT&&redirectToLogout(),hideLoader(),e&&showAttentionSwal()}}))})}function showAttentionSwal(){swal({title:"Security+ Disabled",text:"Please remember to remove account from your Google Authenticator App.",type:"info",showCancelButton:!1,confirmButtonColor:"#DD6B55",confirmButtonText:"Okay",closeOnConfirm:!0},function(e){e&&goToPage("/settings")})}function loginWithMfa(){var e=$("#form_qr_code").parsley().validate();if(e){showLoader();var a=$("#form_qr_code").serialize();$.ajax({type:"POST",url:"/user/secure_login",data:a,dataType:"json",success:function(e){hideLoader(),1==e.error?($("#form_qr_code").find("#qr_code").closest(".form-group").addClass("has-error"),$("#form_qr_code").find("#qr_code").closest(".form-group").find(".help-block").html("Invalid Authentication Code. Check that you have entered the correct code from the Google Authenticator App."),x,$("#form_qr_code").find("#qr_code").focus()):window.location.href="/securingPage"}})}}function showReset(){$("#div_mfa").hide(),$("#div_mfa_reset").show()}function sendOTP(){var e=$("#qr_modal").find("#mobile_number").val();showLoader(),$.ajax({type:"POST",url:"/user/send_otp",data:"mobile_number="+e,dataType:"json",success:function(e){hideLoader(),e&&($("#otp_id").val(e.otp_id),$("#otp").val(e.otp),$("#btn_send_otp").hide(),$("#div_otp_input").show(),$("#btn_submit_otp").show())}})}function submitOTP(){var e=$("#form_deactivate").parsley().validate();if(e){var a=$("#form_deactivate").serialize(),r=$("#form_qr_code").find("#user").val();a+="&user="+r,showLoader(),$.ajax({type:"POST",url:"/user/submit_otp",data:a,dataType:"json",success:function(e){hideLoader(),1==e.otp_verified?(closeModal("#qr_modal"),swal("MFA Deactivated","","success")):($("#otp").closest(".form-group").addClass("has-error"),$("#otp").closest(".form-group").find(".help-block").html("Invalid OTP."),$("#otp").focus())}})}}function adminLoginWithMfa(){$("#facebox").find("#form_qr_code").validationEngine("attach");var e=$("#facebox").find("#form_qr_code").validationEngine("validate");if(e){var a=$("#facebox").find("#form_qr_code").serialize();$.ajax({type:"POST",url:"login.php?action=secure_login",data:a,dataType:"json",success:function(e){1==e.error?($("#facebox").find("#mfa_message").html("Invalid Authentication Code"),$("#facebox").find("#mfa_message").show(),$("#facebox").find("#qr_code").val("")):window.location.href="dashboard.php"}})}}function loginWithVerification(){var e=$("#form_verify_code").parsley().validate();if(e){showLoader();var a=$("#form_verify_code").serialize();$.ajax({type:"POST",url:"/user/verify_login",data:a,dataType:"json",success:function(e){hideLoader(),1==e.error?($("#form_verify_code").find("#verify_code").closest(".form-group").addClass("has-error"),$("#form_verify_code").find("#verify_code").closest(".form-group").find(".help-block").html("Invalid Verification Code. Check that you have entered the correct code."),$("#form_verify_code").find("#verify_code").focus()):window.location.href="/securingPage"}})}}function showloginDiv(){$("#verify_div").css("display","none"),$("#l-login").css("display","inline-block")}function showVerifyDiv(){$("#verify_div").css("display","inline-block"),$("#l-login").css("display","none")}